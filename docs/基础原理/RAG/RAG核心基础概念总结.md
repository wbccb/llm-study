# RAG核心基础概念总结
- 语义
- 意图
- 相似问
- 关键字
- 标签


## 语义

语言所承载意义或者意图，从技术上可以理解为：模型通过向量空间对语言所表达的"概念"、"关系"、"意图"的数字化抽象表示

比如
- "猫"和"狗"的向量距离，会比"猫"和"汽车"更近

比如
- "苹果很好吃。" → "苹果" ≈ 水果
- "我买了一部苹果。" → "苹果" ≈ 手机品牌


## 意图

`意图`是用户说这句话`想干什么`，例如
- "怎么重置密码" => 意图 = `password_reset`
- "你们支持退款吗" => 意图 = `ask_refund_policy`
----------------------------------------------------------------------------------------------------------------
`意图`是从`语义`中提炼出来的，要判断一句话的意图，需要先理解它的语义，例如：
- 用户输入: "我密码忘了，登不进去"
- 语义理解: 用户表达了"登录失败"，原因是"忘记密码"
- 意图判断: `password_reset`

意图是有限的，语义是无限的
- 意图：ask_refund_policy
- 用户可能说：
  - "能退钱吗？"
  - "我不想要了，怎么退款？"
  - "下单错了，支持退货退款吗？"
  - "支付后反悔了，有后悔药没？"
  - "这个东西我不满意，你们怎么处理？"

➡️ 如果没有语义理解能力，你必须为每一种表达都"人工标注"它属于哪个意图 —— 成本极高，且无法覆盖长尾表达。

LLM 的语义理解能力，让你无需穷举所有问法，也能泛化识别出它们属于同一个意图

----------------------------------------------------------------------------------------------------------------
单纯使用`语义`，可能会导致`过度泛化`，输出不可控

单纯使用`意图`，无法覆盖未知意图，长尾表达难处理（在真实世界中，长尾表达才是常态。能处理长尾，才能真正"听得懂人话"）
> 长尾表达（Long-tail Expressions）：成千上万种低频、非标、口语化、个性化、甚至语法错误的问法 ===> 用户用各种你想不到的方式，表达同一个意图

### 语义 + 意图结合
1. 第一阶段（语义检索）：用户提问->生成语义向量->chunk向量库检索TopK片段
2. 第二阶段（意图判断，可选）：对用户提问进行意图分类，比如是`password_reset`，则检索某一个标签下的`chunks`
3. 第三阶段（生成答案）：LLM结合检索到chunks(语义相关 + 意图上下文)，生成最终答案

## 相似问

与语义结合增强`泛化`和`召回`

语义 + 相似问 = 理解用户可能怎么问

## 关键字

LLM的语义向量有时候过于泛化，关键字提供`硬匹配`能力
- 过滤与排序：在检索阶段，先用关键字过滤掉完全不相关的文档，再用语义向量排序
- 混合检索：很多RAG系统都采用`关键字匹配` + `语义检索`的混合模式，兼顾准确率和召回率


语义 + 关键字 = 平衡`模块匹配` + `精确匹配`

## 标签

人为定义的、用于分类或者标记内容的元数据，为语义理解提供了`结构化约束`和`业务上下文`
- 缩小检索范围：可以限定在某一个标签下检索避免返回无关内容
- 领域适配：不同标签对应不同领域的知识，可以加载不同的LLM提示词
- 权限与路由：某些标签对特定用户可见


在`RagFlow`中，标签集可以作为`封闭域知识`的补充，引导LLM输出符合业务规范的答案

语义 + 标签 = 理解内容属于哪个领域/类别


### 如何通过语义"知道"是哪个标签

#### 1. 语义向量相似度匹配

- 为每一个标签预先定义一个或者多个代表句，将这些代表句编码为向量，作为`标签向量`
- 当有新的chunk或者用户问题进来时，计算其语义向量与所有`标签向量`的相似度 => 得出预测标签

#### 2. 提供正确示例让LLM进行标签判断

```text
请根据以下示例，为新问题打上最合适的标签。可选标签：[账户管理, 支付问题, 产品咨询]

示例1：
问题：怎么修改登录密码？
标签：账户管理

示例2：
问题：付款时提示失败怎么办？
标签：支付问题

示例3：
问题：这个报表能导出成 Excel 吗？
标签：产品咨询

新问题：我忘记密码了，能重设吗？
标签：
```

缺点：
- 成本较高（每次调用 LLM）；
- 适合对准确率要求极高、或标签体系复杂的场景；

#### 3. 训练一个语义分类模块

收集问题+标签，训练模型

缺点：
- 需要标注数据，启动成本高；
- 标签体系变更时需重新训练或微调；
- 长尾表达泛化能力不如 LLM


### RagFlow如何标记标签

通过 API 上传 Chunk 时标记标签
```json
{
  "content": "如何重置RagFlow管理员密码？",
  "metadata": {
    "tags": ["账户管理", "系统管理"]
  }
}
```

