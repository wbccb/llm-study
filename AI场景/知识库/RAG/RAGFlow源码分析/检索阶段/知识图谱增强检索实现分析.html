<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å®ç°åˆ†æ | å¤§æ¨¡å‹ç›¸å…³å­¦ä¹ ç”µå­ä¹¦</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/llm-study/assets/style.DNtqXTzv.css" as="style">
    <link rel="preload stylesheet" href="/llm-study/vp-icons.css" as="style">
    
    <script type="module" src="/llm-study/assets/app.DobkWqeM.js"></script>
    <link rel="preload" href="/llm-study/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/llm-study/assets/chunks/theme.SSXXl_Mi.js">
    <link rel="modulepreload" href="/llm-study/assets/chunks/framework.OqxnQCTf.js">
    <link rel="modulepreload" href="/llm-study/assets/AIåœºæ™¯_çŸ¥è¯†åº“_RAG_RAGFlowæºç åˆ†æ_æ£€ç´¢é˜¶æ®µ_çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å®ç°åˆ†æ.md.CR8oV5cM.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-742e49de><!--[--><!--]--><!--[--><span tabindex="-1" data-v-9f13bb77></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-9f13bb77> Skip to content </a><!--]--><!----><header class="VPNav" data-v-742e49de data-v-91f6d2c4><div class="VPNavBar" data-v-91f6d2c4 data-v-215641af><div class="wrapper" data-v-215641af><div class="container" data-v-215641af><div class="title" data-v-215641af><div class="VPNavBarTitle has-sidebar" data-v-215641af data-v-d4c20f81><a class="title" href="/llm-study/" data-v-d4c20f81><!--[--><!--]--><!----><span data-v-d4c20f81>å¤§æ¨¡å‹ç›¸å…³å­¦ä¹ ç”µå­ä¹¦</span><!--[--><!--]--></a></div></div><div class="content" data-v-215641af><div class="content-body" data-v-215641af><!--[--><!--]--><div class="VPNavBarSearch search" data-v-215641af><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-215641af data-v-b647a589><span id="main-nav-aria-label" class="visually-hidden" data-v-b647a589> Main Navigation </span><!--[--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/wbccb/llm-study" target="_blank" rel="noreferrer" tabindex="0" data-v-b647a589 data-v-1fb181da><!--[--><span data-v-1fb181da>Home</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-215641af data-v-c70c92e5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-c70c92e5 data-v-283503e8 data-v-90f5b141><span class="check" data-v-90f5b141><span class="icon" data-v-90f5b141><!--[--><span class="vpi-sun sun" data-v-283503e8></span><span class="vpi-moon moon" data-v-283503e8></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-215641af data-v-a8da1025 data-v-2859b442><!--[--><a class="VPSocialLink no-icon" href="https://github.com/wbccb" aria-label="github" target="_blank" rel="noopener" data-v-2859b442 data-v-b1764eb7><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-215641af data-v-aac53f3a data-v-658bf2d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-658bf2d3><span class="vpi-more-horizontal icon" data-v-658bf2d3></span></button><div class="menu" data-v-658bf2d3><div class="VPMenu" data-v-658bf2d3 data-v-4fd58e9a><!----><!--[--><!--[--><!----><div class="group" data-v-aac53f3a><div class="item appearance" data-v-aac53f3a><p class="label" data-v-aac53f3a>Appearance</p><div class="appearance-action" data-v-aac53f3a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-aac53f3a data-v-283503e8 data-v-90f5b141><span class="check" data-v-90f5b141><span class="icon" data-v-90f5b141><!--[--><span class="vpi-sun sun" data-v-283503e8></span><span class="vpi-moon moon" data-v-283503e8></span><!--]--></span></span></button></div></div></div><div class="group" data-v-aac53f3a><div class="item social-links" data-v-aac53f3a><div class="VPSocialLinks social-links-list" data-v-aac53f3a data-v-2859b442><!--[--><a class="VPSocialLink no-icon" href="https://github.com/wbccb" aria-label="github" target="_blank" rel="noopener" data-v-2859b442 data-v-b1764eb7><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-215641af data-v-00cb0c87><span class="container" data-v-00cb0c87><span class="top" data-v-00cb0c87></span><span class="middle" data-v-00cb0c87></span><span class="bottom" data-v-00cb0c87></span></span></button></div></div></div></div><div class="divider" data-v-215641af><div class="divider-line" data-v-215641af></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-742e49de data-v-0879a5b3><div class="container" data-v-0879a5b3><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-0879a5b3><span class="vpi-align-left menu-icon" data-v-0879a5b3></span><span class="menu-text" data-v-0879a5b3>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-0879a5b3 data-v-f8fe4249><button data-v-f8fe4249>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-742e49de data-v-766c6071><div class="curtain" data-v-766c6071></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-766c6071><span class="visually-hidden" id="sidebar-aria-label" data-v-766c6071> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-274e7dfb><section class="VPSidebarItem level-0" data-v-274e7dfb data-v-75759a6c><div class="item" role="button" tabindex="0" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><h2 class="text" data-v-75759a6c>python</h2><!----></div><div class="items" data-v-75759a6c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/python/1.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>åŸºç¡€çŸ¥è¯†</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-274e7dfb><section class="VPSidebarItem level-0" data-v-274e7dfb data-v-75759a6c><div class="item" role="button" tabindex="0" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><h2 class="text" data-v-75759a6c>æ·±åº¦å­¦ä¹ </h2><!----></div><div class="items" data-v-75759a6c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>åŸºæœ¬æ¦‚å¿µ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E4%B8%BB%E6%B5%81%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86/DeepSeek.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>DeepSeek</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-274e7dfb><section class="VPSidebarItem level-0" data-v-274e7dfb data-v-75759a6c><div class="item" role="button" tabindex="0" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><h2 class="text" data-v-75759a6c>æ·±åº¦å­¦ä¹ -æå®æ¯…</h2><!----></div><div class="items" data-v-75759a6c><!--[--><section class="VPSidebarItem level-1" data-v-75759a6c data-v-75759a6c><div class="item" role="button" tabindex="0" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><h3 class="text" data-v-75759a6c>2021å¹´ & 2022å¹´</h3><!----></div><div class="items" data-v-75759a6c><!--[--><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2021%E5%B9%B4&amp;2022%E5%B9%B4/1.%E4%BA%86%E8%A7%A3%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>äº†è§£çº¿æ€§æ¨¡å‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2021%E5%B9%B4&amp;2022%E5%B9%B4/2.%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>æœºå™¨å­¦ä¹ æ¡†æ¶</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-75759a6c data-v-75759a6c><div class="item" role="button" tabindex="0" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><h3 class="text" data-v-75759a6c>2023å¹´&2024å¹´</h3><!----></div><div class="items" data-v-75759a6c><!--[--><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2023%E5%B9%B4&amp;2024%E5%B9%B4/1.chatGPT.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>chatGPT</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2023%E5%B9%B4&amp;2024%E5%B9%B4/2.%E7%94%9F%E6%88%90%E5%BC%8FAI.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>ç”Ÿæˆå¼AI</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2023%E5%B9%B4&amp;2024%E5%B9%B4/3.%E4%B8%8D%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B=%3E%E5%BC%BA%E5%8C%96%E6%A8%A1%E5%9E%8B.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>ä¸è®­ç»ƒæ¨¡å‹=>å¼ºåŒ–æ¨¡å‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2023%E5%B9%B4&amp;2024%E5%B9%B4/4.%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E6%AD%A5%E9%AA%A4.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>è®­ç»ƒæ¨¡å‹æ­¥éª¤</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2023%E5%B9%B4&amp;2024%E5%B9%B4/5.Transformer.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>Transformer</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2023%E5%B9%B4&amp;2024%E5%B9%B4/6.%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E8%83%BD%E5%8A%9B&amp;%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>è¯„ä¼°æ¨¡å‹èƒ½åŠ›&æ¨¡å‹çš„å®‰å…¨æ€§</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2023%E5%B9%B4&amp;2024%E5%B9%B4/7.%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>ç”Ÿæˆç­–ç•¥</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9D%8E%E5%AE%8F%E6%AF%85/2023%E5%B9%B4&amp;2024%E5%B9%B4/8.Video%E7%9B%B8%E5%85%B3%E7%9A%84%E7%94%9F%E6%88%90%E5%BC%8FAI%E6%8A%80%E6%9C%AF.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>Videoç›¸å…³çš„ç”Ÿæˆå¼AIæŠ€æœ¯</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-274e7dfb><section class="VPSidebarItem level-0" data-v-274e7dfb data-v-75759a6c><div class="item" role="button" tabindex="0" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><h2 class="text" data-v-75759a6c>çŸ¥è¯†åº“</h2><!----></div><div class="items" data-v-75759a6c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E7%9F%A5%E8%AF%86%E5%BA%93/NLP+%E5%A4%A7%E6%A8%A1%E5%9E%8B=%3E%E9%97%AE%E7%AD%94.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>NLP+å¤§æ¨¡å‹=>é—®ç­”</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1" data-v-75759a6c data-v-75759a6c><div class="item" role="button" tabindex="0" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><h3 class="text" data-v-75759a6c>RAGFlowæºç åˆ†æ</h3><!----></div><div class="items" data-v-75759a6c><!--[--><div class="VPSidebarItem level-2 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E7%9F%A5%E8%AF%86%E5%BA%93/RAG/RAGFlow%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%96%87%E6%A1%A3%E9%A2%84%E5%A4%84%E7%90%86%E9%98%B6%E6%AE%B5/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0&amp;%E8%A7%A3%E6%9E%90%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>æ–‡ä»¶ä¸Šä¼ &è§£ææ•´ä½“æµç¨‹</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2" data-v-75759a6c data-v-75759a6c><div class="item" role="button" tabindex="0" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><h4 class="text" data-v-75759a6c>æ··åˆæ£€ç´¢ç­–ç•¥</h4><!----></div><div class="items" data-v-75759a6c><!--[--><div class="VPSidebarItem level-3 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E7%9F%A5%E8%AF%86%E5%BA%93/RAG/RAGFlow%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%A3%80%E7%B4%A2%E9%98%B6%E6%AE%B5/(WIP)%E6%B7%B7%E5%90%88%E6%A3%80%E7%B4%A2%E7%AD%96%E7%95%A5.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>æ··åˆæ£€ç´¢ç­–ç•¥</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-75759a6c data-v-75759a6c><div class="item" data-v-75759a6c><div class="indicator" data-v-75759a6c></div><a class="VPLink link link" href="/llm-study/%E7%9F%A5%E8%AF%86%E5%BA%93/RAG/RAGFlow%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%A3%80%E7%B4%A2%E9%98%B6%E6%AE%B5/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E5%A2%9E%E5%BC%BA%E6%A3%80%E7%B4%A2%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90.html" data-v-75759a6c><!--[--><p class="text" data-v-75759a6c>çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-742e49de data-v-4df68d91><div class="VPDoc has-sidebar has-aside" data-v-4df68d91 data-v-0ed8b67e><!--[--><!--]--><div class="container" data-v-0ed8b67e><div class="aside" data-v-0ed8b67e><div class="aside-curtain" data-v-0ed8b67e></div><div class="aside-container" data-v-0ed8b67e><div class="aside-content" data-v-0ed8b67e><div class="VPDocAside" data-v-0ed8b67e data-v-4d7da887><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-4d7da887 data-v-b577ee35><div class="content" data-v-b577ee35><div class="outline-marker" data-v-b577ee35></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b577ee35>On this page</div><ul class="VPDocOutlineItem root" data-v-b577ee35 data-v-07a964c1><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-4d7da887></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-0ed8b67e><div class="content-container" data-v-0ed8b67e><!--[--><!--]--><main class="main" data-v-0ed8b67e><div style="position:relative;" class="vp-doc _llm-study_AI%E5%9C%BA%E6%99%AF_%E7%9F%A5%E8%AF%86%E5%BA%93_RAG_RAGFlow%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90_%E6%A3%80%E7%B4%A2%E9%98%B6%E6%AE%B5_%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E5%A2%9E%E5%BC%BA%E6%A3%80%E7%B4%A2%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90" data-v-0ed8b67e><div><blockquote><p>ç”±äºRAGFlowçš„ä»£ç æ›´æ–°éå¸¸é¢‘ç¹ï¼Œå› æ­¤å¼ºè°ƒæœ¬æ–‡æ‰€å±•ç¤ºçš„æºç å’Œåˆ†ææ˜¯åŸºäº2025/4/2 13:56çš„ä»£ç è¿›è¡Œï¼Œéšç€æ—¶é—´çš„æ¨ç§»å¯èƒ½æœ‰æ‰€æ”¹å˜</p></blockquote><h1 id="çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å®ç°åˆ†æ" tabindex="-1">çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å®ç°åˆ†æ <a class="header-anchor" href="#çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å®ç°åˆ†æ" aria-label="Permalink to &quot;çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å®ç°åˆ†æ&quot;">â€‹</a></h1><blockquote><p>graphrag/search.py</p></blockquote><p><code>retrieval()</code> æ–¹æ³•çš„ä¸»è¦æµç¨‹ä¸»è¦åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>æŸ¥è¯¢é‡å†™ï¼šè°ƒç”¨ <code>query_rewrite()</code> æ–¹æ³•ï¼Œå°†ç”¨æˆ·çš„é—®é¢˜è½¬æ¢ä¸º <code>ç±»å‹å…³é”®è¯</code> å’Œ <code>å®ä½“åˆ—è¡¨</code></li><li>æ£€ç´¢ç›¸å…³å®ä½“ï¼šé€šè¿‡ <code>get_relevants_by_keywords()</code> å’Œ <code>get_relevant_ents_by_types()</code> æ–¹æ³•ï¼Œæ ¹æ® <code>å…³é”®è¯</code> å’Œ <code>ç±»å‹</code> ä»çŸ¥è¯†å›¾è°±ä¸­æ£€ç´¢å®ä½“</li><li>æ£€ç´¢ç›¸å…³å…³ç³»ï¼šé€šè¿‡ <code>get_relevant_relations_by_txt()</code> æ–¹æ³•ï¼ŒåŸºäºé—®é¢˜æ–‡æœ¬æ£€ç´¢å…³ç³»è·¯å¾„ï¼Œå³åŸºäºè¯­ä¹‰çš„å…³ç³»æ£€ç´¢</li><li>æ•´åˆã€æ’åºç»“æœ</li><li>ç¤¾åŒºæŠ¥å‘Šæ£€ç´¢ï¼šè°ƒç”¨ <code>_community_retrival_()</code> æ–¹æ³•ï¼Œæ ¹æ®æ£€ç´¢åˆ°çš„å®ä½“è·å–ç›¸å…³çš„ç¤¾åŒºæ‘˜è¦</li></ol><h2 id="æŸ¥è¯¢é‡å†™query-rewrite" tabindex="-1">æŸ¥è¯¢é‡å†™query_rewrite() <a class="header-anchor" href="#æŸ¥è¯¢é‡å†™query-rewrite" aria-label="Permalink to &quot;æŸ¥è¯¢é‡å†™query_rewrite()&quot;">â€‹</a></h2><p><code>ty_kwds, ents = self.query_rewrite(llm, qst, [index_name(tid) for tid in tenant_ids], kb_ids)</code></p><ul><li>å…ˆä½¿ç”¨ <code>æ··åˆæ£€ç´¢retrievaler.search()</code> å¾—åˆ° <code>ty2ents</code>ï¼Œä¹Ÿå°±æ˜¯<code>Answer type pool</code></li><li>ç„¶åæ‹¼æ¥å‡º <code>hint_prompt</code>ï¼Œä½¿ç”¨ <code>llm-chatå¤§æ¨¡å‹</code>è·å– <code>answer_type_keywords</code> å’Œ <code>entities_from_query</code><ul><li><code>answer_type_keywords</code> ï¼šé—®é¢˜çš„ç±»å‹ï¼Œä» <code>Answer type pool</code> ä¸­è·å–ï¼Œå¯èƒ½æ€§æœ€é«˜çš„ç±»å‹æ”¾åœ¨å‰é¢ï¼Œä¸è¶…è¿‡3ä¸ª</li><li><code>entities_from_query</code>ï¼šç‰¹å®šå®ä½“æˆ–è€…è¯¦ç»†ä¿¡æ¯ï¼Œä»æŸ¥è¯¢ä¸­è·å–</li></ul></li><li>è¿”å› <code>answer_type_keywords</code> å’Œ <code>entities_from_query</code></li></ul><blockquote><p><code>answer_type_keywords</code> ä»£è¡¨ç€ query çš„ç±»å‹ï¼Œæ¯”å¦‚ä½ é—®çš„é—®é¢˜å¯èƒ½æ˜¯çˆ¶å­å…³ç³»ï¼Ÿå¯èƒ½æ˜¯åœ°æ–¹åå­—ï¼Ÿå¯èƒ½æ˜¯é£Ÿç‰©ï¼Ÿ</p><p><code>entities_from_query</code> ä»£è¡¨ç€ query æ‰€åŒ…å«çš„å®ä½“ ä»¥åŠ å¯èƒ½æœ‰å…³è”çš„å®ä½“</p></blockquote><blockquote><p>ä¸Šé¢çš„æµç¨‹å¯èƒ½è¿‡äºæŠ½è±¡ï¼Œå¯ä»¥å‚è€ƒ <code>graphrag/query_analyze_prompt.py</code> çš„ <code>PROMPTS[&quot;minirag_query2kwd&quot;]</code></p></blockquote><hr><p>ä¸Šé¢çš„æµç¨‹å¯ä»¥ä½¿ç”¨<code>graphrag/query_analyze_prompt.py</code>ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºï¼š</p><ul><li><code>æ··åˆæ£€ç´¢retrievaler.search()</code> å¾—åˆ° <code>TYPE_POOL</code></li><li>æ‹¼æ¥ <code>Query: {query}</code> + <code>Answer type pool:{TYPE_POOL}</code> ä¸º prompt è¿›è¡ŒLLMçš„æé—®ï¼Œè¦æ±‚å¾—åˆ° <code>answer_type_keywords</code> å’Œ <code>entities_from_query</code></li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#############################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Query: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Where is the capital of the United States?&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Answer </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pool: {{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ORGANIZATION&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GREENPEACE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;RED CROSS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PERSONAL LIFE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DAILY WORKOUT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HOME COOKING&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;STRATEGY&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;FINANCIAL INVESTMENT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;BUSINESS EXPANSION&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;SERVICE FACILITATION&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ONLINE SUPPORT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CUSTOMER SERVICE TRAINING&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PERSON&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALBERTA SMITH&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;BENJAMIN JONES&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;FOOD&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PASTA CARBONARA&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SUSHI PLATTER&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;EMOTION&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HAPPINESS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SADNESS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PERSONAL EXPERIENCE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TRAVEL ADVENTURE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;BOOK CLUB&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;INTERACTION&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TEAM BUILDING&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;NETWORKING MEETUP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;BEVERAGE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;LATTE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GREEN TEA&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PLAN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WEIGHT LOSS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CAREER DEVELOPMENT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;GEO&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PARIS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;NEW YORK&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;GEAR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CAMERA&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HEADPHONES&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;EMOJI&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ğŸ¢&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ğŸŒ&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;BEHAVIOR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POSITIVE THINKING&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;STRESS MANAGEMENT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;TONE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;FRIENDLY&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PROFESSIONAL&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;LOCATION&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DOWNTOWN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SUBURBS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Output:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;answer_type_keywords&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LOCATION&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;entities_from_query&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;capital of the United States&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Washington&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;New York&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#############################</span></span></code></pre></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> query_rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, llm, question, idxnms, kb_ids):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ty2ents </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> trio.run(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: get_entity_type2sampels(idxnms, kb_ids))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hint_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PROMPTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;minirag_query2kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].format(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">question,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                                                        TYPE_POOL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">json.dumps(ty2ents, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ensure_ascii</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">indent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._chat(llm, hint_prompt, [{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Output:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}], {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    keywords_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json_repair.loads(result)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    type_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> keywords_data.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;answer_type_keywords&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    entities_from_query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> keywords_data.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entities_from_query&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [])[:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> type_keywords, entities_from_query</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_entity_type2sampels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(idxnms, kb_ids: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    es_res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> trio.to_thread.run_sync(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: settings.retrievaler.search({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;knowledge_graph_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ty2ents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kb_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: kb_ids,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                       &quot;size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                       &quot;fields&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      idxnms, kb_ids))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _chat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, llm_bdl, system, history, gen_conf):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_llm_cache(llm_bdl.llm_name, system, history, gen_conf)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_bdl.chat(system, history, gen_conf)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.find(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**ERROR**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    set_llm_cache(llm_bdl.llm_name, system, response, history, gen_conf)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response</span></span></code></pre></div><h2 id="æ£€ç´¢ç›¸å…³å®ä½“" tabindex="-1">æ£€ç´¢ç›¸å…³å®ä½“ <a class="header-anchor" href="#æ£€ç´¢ç›¸å…³å®ä½“" aria-label="Permalink to &quot;æ£€ç´¢ç›¸å…³å®ä½“&quot;">â€‹</a></h2><p>ä» <code>query_rewrite()</code> æˆ‘ä»¬å¾—åˆ°äº† <code>ty_kwdsæŸ¥è¯¢é—®é¢˜çš„ç±»å‹</code> + <code>entsæŸ¥è¯¢é—®é¢˜ç›¸å…³è”çš„å®ä½“</code></p><p>ç„¶åè§¦å‘<code>get_relevants_by_keywords()</code> å’Œ <code>get_relevant_ents_by_types()</code></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ents_from_query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get_relevant_ents_by_keywords(ents, filters, idxnms, kb_ids, emb_mdl, ent_sim_threshold)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ents_from_types </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get_relevant_ents_by_types(ty_kwds, filters, idxnms, kb_ids, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><blockquote><p>æœ¬è´¨è¿˜æ˜¯é€šè¿‡ <code>ES</code> é…ç½®å‚æ•°å»æ£€ç´¢å¯¹åº”çš„å®ä½“</p></blockquote><p><strong>é€šè¿‡å…³é”®è¯æ£€ç´¢ç›¸å…³å®ä½“</strong>ï¼šget_relevant_ents_by_keywords</p><p>æ‹¿åˆ° <code>&quot;entities_from_query&quot;: [&quot;capital of the United States&quot;, &quot;Washington&quot;, &quot;New York&quot;]</code> çš„ç›¸å…³å®ä½“</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filters[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;knowledge_graph_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;entity&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">matchDense </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get_vector(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;, &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(keywords), emb_mdl, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sim_thr)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">matchExprs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [matchDense]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ESè¯·æ±‚...</span></span></code></pre></div><p><strong>é€šè¿‡é—®é¢˜ç±»å‹æ£€ç´¢ç›¸å…³å®ä½“</strong>ï¼šget_relevant_ents_by_types</p><p>æ‹¿åˆ° <code>&quot;answer_type_keywords&quot;: [&quot;LOCATION&quot;]</code> çš„ç›¸å…³å®ä½“</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filters[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;knowledge_graph_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;entity&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filters[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entity_type_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> types</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">matchDense </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ESè¯·æ±‚...</span></span></code></pre></div><h2 id="æ£€ç´¢ç›¸å…³å…³ç³»" tabindex="-1">æ£€ç´¢ç›¸å…³å…³ç³» <a class="header-anchor" href="#æ£€ç´¢ç›¸å…³å…³ç³»" aria-label="Permalink to &quot;æ£€ç´¢ç›¸å…³å…³ç³»&quot;">â€‹</a></h2><blockquote><p>æœ¬è´¨è¿˜æ˜¯é€šè¿‡ <code>ES</code> é…ç½®å‚æ•°å»æ£€ç´¢å¯¹åº”çš„å®ä½“</p></blockquote><p>æ‹¿åˆ°å½“å‰é—®é¢˜queryç›¸å…³çš„å…³ç³»è·¯å¾„ï¼Œæ¯”å¦‚ <code>&quot;relations&quot;: [{&quot;From&quot;: &quot;Washington&quot;, &quot;To&quot;: &quot;United States&quot;, &quot;Score&quot;: 1.08}]</code></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> question</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rels_from_txt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get_relevant_relations_by_txt(qst, filters, idxnms, kb_ids, emb_mdl, rel_sim_threshold)</span></span></code></pre></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filters[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;knowledge_graph_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;relation&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">matchDense </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get_vector(txt, emb_mdl, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sim_thr)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">matchExprs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [matchDense]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ESè¯·æ±‚...</span></span></code></pre></div><h2 id="æ•´åˆã€æ’åºç»“æœ" tabindex="-1">æ•´åˆã€æ’åºç»“æœ <a class="header-anchor" href="#æ•´åˆã€æ’åºç»“æœ" aria-label="Permalink to &quot;æ•´åˆã€æ’åºç»“æœ&quot;">â€‹</a></h2><h3 id="è¿‡æ»¤ä½åˆ†ä¿¡æ¯" tabindex="-1">è¿‡æ»¤ä½åˆ†ä¿¡æ¯ <a class="header-anchor" href="#è¿‡æ»¤ä½åˆ†ä¿¡æ¯" aria-label="Permalink to &quot;è¿‡æ»¤ä½åˆ†ä¿¡æ¯&quot;">â€‹</a></h3><p>é€šè¿‡ <code>get_relevants_by_keywords()</code> å’Œ <code>get_relevant_ents_by_types()</code> æ–¹æ³•æ£€ç´¢ESï¼Œä½¿ç”¨ <code>_ent_info_from_()</code> è¿›è¡Œ <code>sim_thr</code> çš„è¿‡æ»¤ä»¥åŠå…³é”®ä¿¡æ¯çš„æå–</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _ent_info_from_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, es_res, sim_thr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    flds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rank_flt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;n_hop_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    es_res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dataStore.getFields(es_res, flds)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, ent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> es_res.items():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flds:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent[f] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                del</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent[f]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_float(ent.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim_thr:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            continue</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res[ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: get_float(ent.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;pagerank&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: get_float(ent.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rank_flt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;n_hop_ents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: json.loads(ent.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;n_hop_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ent.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res</span></span></code></pre></div><p>é€šè¿‡ <code>get_relevant_relations_by_txt()</code> æ–¹æ³•æ£€ç´¢ESï¼Œä½¿ç”¨ <code>_relation_info_from_()</code>è¿›è¡Œ <code>sim_thr</code> çš„è¿‡æ»¤ä»¥åŠå…³é”®ä¿¡æ¯çš„æå–</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _relation_info_from_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, es_res, sim_thr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    es_res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dataStore.getFields(es_res, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;from_entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;to_entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                &quot;weight_int&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, ent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> es_res.items():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_float(ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim_thr:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            continue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        f, t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sorted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;from_entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;to_entity_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(f, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res[(f, t)] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: get_float(ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;pagerank&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: get_float(ent.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight_int&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res</span></span></code></pre></div><h3 id="å¤šè·³è·¯å¾„æ•´åˆ-ä»ents-from-queryä¸­è·å–" tabindex="-1">å¤šè·³è·¯å¾„æ•´åˆï¼šä»ents_from_queryä¸­è·å– <a class="header-anchor" href="#å¤šè·³è·¯å¾„æ•´åˆ-ä»ents-from-queryä¸­è·å–" aria-label="Permalink to &quot;å¤šè·³è·¯å¾„æ•´åˆï¼šä»ents_from_queryä¸­è·å–&quot;">â€‹</a></h3><p>å‡è®¾ <code>ent[sim]</code> = 0.92ï¼Œé‚£ä¹ˆ</p><ul><li>è·¯å¾„é•¿åº¦ä¸º 1 æ—¶ï¼Œæƒé‡ = 0.92 / (2+0) = 0.46</li><li>è·¯å¾„é•¿åº¦ä¸º 2 æ—¶ï¼Œæƒé‡ = 0.92 / (2+1) = 0.31</li></ul><blockquote><p>å¤šè·³è¡°å‡</p></blockquote><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, ent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ents_from_query.items():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    nhops </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;n_hop_ents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nbr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nhops:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nbr[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        wts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nbr[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weights&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(path) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            f, t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> path[i], path[i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (f, t) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nhop_pathes:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                nhop_pathes[(f, t)][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                nhop_pathes[(f, t)][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            nhop_pathes[(f, t)][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pagerank&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wts[i]</span></span></code></pre></div><h3 id="ç±»å‹åŒ¹é…åˆ°çš„å®ä½“æƒé‡ç¿»å€" tabindex="-1">ç±»å‹åŒ¹é…åˆ°çš„å®ä½“æƒé‡ç¿»å€ <a class="header-anchor" href="#ç±»å‹åŒ¹é…åˆ°çš„å®ä½“æƒé‡ç¿»å€" aria-label="Permalink to &quot;ç±»å‹åŒ¹é…åˆ°çš„å®ä½“æƒé‡ç¿»å€&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ents_from_types.keys():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ents_from_query:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        continue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ents_from_query[ent][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span></code></pre></div><h3 id="å…³ç³»relationså’Œç±»å‹å¾—åˆ°çš„å®ä½“entityè¿›è¡Œæ··åˆè¯„åˆ†" tabindex="-1">å…³ç³»relationså’Œç±»å‹å¾—åˆ°çš„å®ä½“entityè¿›è¡Œæ··åˆè¯„åˆ† <a class="header-anchor" href="#å…³ç³»relationså’Œç±»å‹å¾—åˆ°çš„å®ä½“entityè¿›è¡Œæ··åˆè¯„åˆ†" aria-label="Permalink to &quot;å…³ç³»relationså’Œç±»å‹å¾—åˆ°çš„å®ä½“entityè¿›è¡Œæ··åˆè¯„åˆ†&quot;">â€‹</a></h3><p>å¦‚æœé€šè¿‡ESå¾—åˆ°çš„relationså…³ç³»ä¸­çš„ <code>ä¸¤ç«¯å®ä½“</code> éƒ½åœ¨ <code>ents_from_types</code> ä¸­ï¼Œåˆ™å¢å¼ºè¯¥æƒé‡</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (f, t) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rels_from_txt.keys():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pair </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sorted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([f, t]))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pair </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nhop_pathes:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nhop_pathes[pair][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        del</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nhop_pathes[pair]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ents_from_types:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ents_from_types:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rels_from_txt[(f, t)][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span></code></pre></div><h3 id="å°†ä»ents-from-queryä¸­è·å–çš„å¤šè·³è·¯å¾„å¹¶å…¥åˆ°rels-from-txtå…³ç³»è·¯å¾„ä¸­" tabindex="-1">å°†ä»ents_from_queryä¸­è·å–çš„å¤šè·³è·¯å¾„å¹¶å…¥åˆ°rels_from_txtå…³ç³»è·¯å¾„ä¸­ <a class="header-anchor" href="#å°†ä»ents-from-queryä¸­è·å–çš„å¤šè·³è·¯å¾„å¹¶å…¥åˆ°rels-from-txtå…³ç³»è·¯å¾„ä¸­" aria-label="Permalink to &quot;å°†ä»ents_from_queryä¸­è·å–çš„å¤šè·³è·¯å¾„å¹¶å…¥åˆ°rels_from_txtå…³ç³»è·¯å¾„ä¸­&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (f, t) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nhop_pathes.keys():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ents_from_types:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ents_from_types:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rels_from_txt[(f, t)] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: nhop_pathes[(f, t)][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;pagerank&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: nhop_pathes[(f, t)][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pagerank&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre></div><h3 id="æ ¹æ®simå’Œpagerankè¿›è¡Œæ’åº" tabindex="-1">æ ¹æ®simå’Œpagerankè¿›è¡Œæ’åº <a class="header-anchor" href="#æ ¹æ®simå’Œpagerankè¿›è¡Œæ’åº" aria-label="Permalink to &quot;æ ¹æ®simå’Œpagerankè¿›è¡Œæ’åº&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ents_from_query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sorted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ents_from_query.items(), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x: x[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pagerank&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reverse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    :ent_topn]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rels_from_txt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sorted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rels_from_txt.items(), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x: x[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pagerank&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reverse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                :rel_topn]</span></span></code></pre></div><h2 id="æ„å»ºentså’Œrelas-ç¤¾åŒºæŠ¥å‘Šæ£€ç´¢" tabindex="-1">æ„å»ºentså’Œrelas + ç¤¾åŒºæŠ¥å‘Šæ£€ç´¢ <a class="header-anchor" href="#æ„å»ºentså’Œrelas-ç¤¾åŒºæŠ¥å‘Šæ£€ç´¢" aria-label="Permalink to &quot;æ„å»ºentså’Œrelas + ç¤¾åŒºæŠ¥å‘Šæ£€ç´¢&quot;">â€‹</a></h2><p>ä¼ å…¥ä»æŸ¥è¯¢é—®é¢˜ä¸­å¾—åˆ°çš„å®ä½“ï¼Œæ„å»ºå¯¹åº”çš„å‚æ•°è¿›è¡ŒESçš„æœç´¢ï¼Œä»ESæŸ¥è¯¢ç»“æœä¸­æ„å»ºå¯¹åº”çš„ç¤¾åŒºæŠ¥å‘Š</p><p>æ‹¼æ¥åˆ° <code>content_with_weight</code> è¿›è¡Œè¿”å›</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># çœç•¥...ents_from_query=&gt;æ„å»ºentsçš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># çœç•¥...rels_from_txt=&gt;æ„å»ºrelasçš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;chunk_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: get_uuid(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;content_ltks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;content_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ents </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> relas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._community_retrival_([n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ents_from_query], filters, kb_ids, idxnms, comm_topn, max_token),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;doc_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;docnm_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Related content in Knowledge Graph&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;kb_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: kb_ids,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;important_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;image_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;similarity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;vector_similarity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;term_similarity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;vector&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;positions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _community_retrival_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, entities, condition, kb_ids, idxnms, topn, max_token):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## Community retrieval</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fields </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docnm_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    odr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OrderByExpr()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    odr.desc(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight_flt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fltr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deepcopy(condition)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fltr[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;knowledge_graph_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;community_report&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fltr[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entities_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entities</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    comm_res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dataStore.search(fields, [], fltr, [],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        OrderByExpr(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, topn, idxnms, kb_ids)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    comm_res_fields </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dataStore.getFields(comm_res, fields)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    txts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ii, (_, row) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(comm_res_fields.items()):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json.loads(row[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content_with_weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        txts.append(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;# </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">. </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">## Content</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n{}\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">## Evidences</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n{}\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.format(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ii </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, row[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docnm_kwd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], obj[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;report&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], obj[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;evidences&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        max_token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_tokens_from_string(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(txts[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> txts:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">---- Community Report ----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(txts)</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-0ed8b67e data-v-fb66563c><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-fb66563c><span class="visually-hidden" id="doc-footer-aria-label" data-v-fb66563c>Pager</span><div class="pager" data-v-fb66563c><!----></div><div class="pager" data-v-fb66563c><a class="VPLink link pager-link next" href="/llm-study/python/1.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" data-v-fb66563c><!--[--><span class="desc" data-v-fb66563c>Next page</span><span class="title" data-v-fb66563c>åŸºç¡€çŸ¥è¯†</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"aiåœºæ™¯_ai_agents_readme.md\":\"CRWSU_WC\",\"aiåœºæ™¯_ai_ç»˜ç”»_stable diffusion_lora.md\":\"B5D_YroA\",\"aiåœºæ™¯_ai_è¾…åŠ©ç¼–ç¨‹_readme.md\":\"C55BNue-\",\"aiåœºæ™¯_çŸ¥è¯†åº“_nlp_å¤§æ¨¡å‹__é—®ç­”.md\":\"CQi0zWp_\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_mineru_readmd.md\":\"OijAGdkG\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_ragflowæºç åˆ†æ_knowledge.md\":\"DsZJAXL1\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_ragflowæºç åˆ†æ_readme.md\":\"8TS2L7rb\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_ragflowæºç åˆ†æ_æ–‡æ¡£é¢„å¤„ç†é˜¶æ®µ_(todo)æ–‡æ¡£è§£ææŠ€æœ¯.md\":\"f6yrKNco\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_ragflowæºç åˆ†æ_æ–‡æ¡£é¢„å¤„ç†é˜¶æ®µ_(todo)æ„å»ºchunké€»è¾‘è¯¦ç»†åˆ†æ.md\":\"DK1Xuv8g\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_ragflowæºç åˆ†æ_æ–‡æ¡£é¢„å¤„ç†é˜¶æ®µ_æ–‡ä»¶ä¸Šä¼ _è§£ææ•´ä½“æµç¨‹.md\":\"C2JZMLHY\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_ragflowæºç åˆ†æ_æ£€ç´¢é˜¶æ®µ_(wip)æ··åˆæ£€ç´¢ç­–ç•¥.md\":\"CrE1lk2s\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_ragflowæºç åˆ†æ_æ£€ç´¢é˜¶æ®µ_çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å®ç°åˆ†æ.md\":\"CR8oV5cM\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_ragflowæºç åˆ†æ_ç”Ÿæˆé˜¶æ®µ_ç”Ÿæˆä¸äº¤äº’æµç¨‹.md\":\"BU1Vu9-8\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_readme.md\":\"BqQrjFeW\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_è¯„åˆ¤æ ‡å‡†_è¯„åˆ¤æ ‡å‡†.md\":\"BXSYBvzp\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_éƒ¨ç½²æ–¹æ¡ˆ_ç¡¬ä»¶é€‰æ‹©.md\":\"C634LRoU\",\"aiåœºæ™¯_çŸ¥è¯†åº“_rag_éƒ¨ç½²æ–¹æ¡ˆ_è½åœ°æŠ€æœ¯é€‰å‹.md\":\"BGcm99iI\",\"index.md\":\"CqxbQE55\",\"åŸºç¡€åŸç†_aiæ¡†æ¶_å¾®è°ƒ_åº•å±‚åŸç†_1.langchain.md\":\"C1BTjdYb\",\"åŸºç¡€åŸç†_aiæ¡†æ¶_å¾®è°ƒ_åº•å±‚åŸç†_2.langgraph.md\":\"NWz4rsiz\",\"åŸºç¡€åŸç†_aiæ¡†æ¶_å¾®è°ƒ_åº•å±‚åŸç†_3.aiåº”ç”¨å¼€å‘_å¾®è°ƒ.md\":\"DnBTqYwT\",\"åŸºç¡€åŸç†_aiæ¡†æ¶_å¾®è°ƒ_åº•å±‚åŸç†_4.nlp_é¢„è®­ç»ƒ_å¾®è°ƒ_aiåº”ç”¨å¼€å‘.md\":\"BlbRiTeC\",\"åŸºç¡€åŸç†_python_1.åŸºç¡€çŸ¥è¯†.md\":\"Crq-zIUg\",\"åŸºç¡€åŸç†_python_djangoæ¡†æ¶-5.1_åŸºæœ¬æ¦‚å¿µ.md\":\"0l_kP0vZ\",\"åŸºç¡€åŸç†_rag_ragæ ¸å¿ƒåŸºç¡€æ¦‚å¿µæ€»ç»“.md\":\"DvGVoUrf\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _readme.md\":\"TbqtyQQn\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _sebastian raschka_1.ç†è§£å¤§æ¨¡å‹.md\":\"DPZtajAw\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _ä¸»æµå¤§æ¨¡å‹åŸç†_deepseek.md\":\"pBQ2s9rY\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _åŸºæœ¬æ¦‚å¿µ.md\":\"DtaEz28J\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _å¾®è°ƒ_readme.md\":\"0BcZJvKQ\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2021å¹´_2022å¹´_1.äº†è§£çº¿æ€§æ¨¡å‹.md\":\"oupVjLlq\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2021å¹´_2022å¹´_2.æœºå™¨å­¦ä¹ æ¡†æ¶.md\":\"DqRLlpk7\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2023å¹´_2024å¹´_1.chatgpt.md\":\"D5C76o68\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2023å¹´_2024å¹´_2.ç”Ÿæˆå¼ai.md\":\"CZTVKBnY\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2023å¹´_2024å¹´_3.ä¸è®­ç»ƒæ¨¡å‹__å¼ºåŒ–æ¨¡å‹.md\":\"jF0iIGti\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2023å¹´_2024å¹´_4.è®­ç»ƒæ¨¡å‹æ­¥éª¤.md\":\"Cay363TM\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2023å¹´_2024å¹´_5.transformer.md\":\"DicLAMbF\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2023å¹´_2024å¹´_6.è¯„ä¼°æ¨¡å‹èƒ½åŠ›_æ¨¡å‹çš„å®‰å…¨æ€§.md\":\"DEpgr6WW\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2023å¹´_2024å¹´_7.ç”Ÿæˆç­–ç•¥.md\":\"DMpCQiFc\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_2023å¹´_2024å¹´_8.videoç›¸å…³çš„ç”Ÿæˆå¼aiæŠ€æœ¯.md\":\"DYprjHNz\",\"åŸºç¡€åŸç†_æ·±åº¦å­¦ä¹ _æå®æ¯…_readmd.md\":\"CxOHfsoI\",\"å®æ–½_è¿ç»´_readme.md\":\"CXJmmPdb\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"å¤§æ¨¡å‹ç›¸å…³å­¦ä¹ ç”µå­ä¹¦\",\"description\":\"A VitePress site\",\"base\":\"/llm-study/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"https://github.com/wbccb/llm-study\"}],\"sidebar\":[{\"text\":\"python\",\"items\":[{\"text\":\"åŸºç¡€çŸ¥è¯†\",\"link\":\"/python/1.åŸºç¡€çŸ¥è¯†.md\"}]},{\"text\":\"æ·±åº¦å­¦ä¹ \",\"items\":[{\"text\":\"åŸºæœ¬æ¦‚å¿µ\",\"link\":\"/æ·±åº¦å­¦ä¹ /åŸºæœ¬æ¦‚å¿µ.md\"},{\"text\":\"DeepSeek\",\"link\":\"/æ·±åº¦å­¦ä¹ /ä¸»æµå¤§æ¨¡å‹åŸç†/DeepSeek.md\"}]},{\"text\":\"æ·±åº¦å­¦ä¹ -æå®æ¯…\",\"items\":[{\"text\":\"2021å¹´ & 2022å¹´\",\"items\":[{\"text\":\"äº†è§£çº¿æ€§æ¨¡å‹\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2021å¹´&2022å¹´/1.äº†è§£çº¿æ€§æ¨¡å‹.md\"},{\"text\":\"æœºå™¨å­¦ä¹ æ¡†æ¶\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2021å¹´&2022å¹´/2.æœºå™¨å­¦ä¹ æ¡†æ¶.md\"}]},{\"text\":\"2023å¹´&2024å¹´\",\"items\":[{\"text\":\"chatGPT\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2023å¹´&2024å¹´/1.chatGPT.md\"},{\"text\":\"ç”Ÿæˆå¼AI\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2023å¹´&2024å¹´/2.ç”Ÿæˆå¼AI.md\"},{\"text\":\"ä¸è®­ç»ƒæ¨¡å‹=>å¼ºåŒ–æ¨¡å‹\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2023å¹´&2024å¹´/3.ä¸è®­ç»ƒæ¨¡å‹=>å¼ºåŒ–æ¨¡å‹.md\"},{\"text\":\"è®­ç»ƒæ¨¡å‹æ­¥éª¤\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2023å¹´&2024å¹´/4.è®­ç»ƒæ¨¡å‹æ­¥éª¤.md\"},{\"text\":\"Transformer\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2023å¹´&2024å¹´/5.Transformer.md\"},{\"text\":\"è¯„ä¼°æ¨¡å‹èƒ½åŠ›&æ¨¡å‹çš„å®‰å…¨æ€§\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2023å¹´&2024å¹´/6.è¯„ä¼°æ¨¡å‹èƒ½åŠ›&æ¨¡å‹çš„å®‰å…¨æ€§.md\"},{\"text\":\"ç”Ÿæˆç­–ç•¥\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2023å¹´&2024å¹´/7.ç”Ÿæˆç­–ç•¥.md\"},{\"text\":\"Videoç›¸å…³çš„ç”Ÿæˆå¼AIæŠ€æœ¯\",\"link\":\"/æ·±åº¦å­¦ä¹ /æå®æ¯…/2023å¹´&2024å¹´/8.Videoç›¸å…³çš„ç”Ÿæˆå¼AIæŠ€æœ¯.md\"}]}]},{\"text\":\"çŸ¥è¯†åº“\",\"items\":[{\"text\":\"NLP+å¤§æ¨¡å‹=>é—®ç­”\",\"link\":\"/çŸ¥è¯†åº“/NLP+å¤§æ¨¡å‹=>é—®ç­”.md\"},{\"text\":\"RAGFlowæºç åˆ†æ\",\"items\":[{\"text\":\"æ–‡ä»¶ä¸Šä¼ &è§£ææ•´ä½“æµç¨‹\",\"link\":\"/çŸ¥è¯†åº“/RAG/RAGFlowæºç åˆ†æ/æ–‡æ¡£é¢„å¤„ç†é˜¶æ®µ/æ–‡ä»¶ä¸Šä¼ &è§£ææ•´ä½“æµç¨‹.md\"},{\"text\":\"æ··åˆæ£€ç´¢ç­–ç•¥\",\"items\":[{\"text\":\"æ··åˆæ£€ç´¢ç­–ç•¥\",\"link\":\"/çŸ¥è¯†åº“/RAG/RAGFlowæºç åˆ†æ/æ£€ç´¢é˜¶æ®µ/(WIP)æ··åˆæ£€ç´¢ç­–ç•¥.md\"},{\"text\":\"çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢\",\"link\":\"/çŸ¥è¯†åº“/RAG/RAGFlowæºç åˆ†æ/æ£€ç´¢é˜¶æ®µ/çŸ¥è¯†å›¾è°±å¢å¼ºæ£€ç´¢å®ç°åˆ†æ.md\"}]}]}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/wbccb\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>